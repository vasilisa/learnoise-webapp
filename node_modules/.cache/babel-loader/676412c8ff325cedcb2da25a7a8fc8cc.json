{"ast":null,"code":"import _classCallCheck from \"/Users/vasilisaskvortsova/Documents/COVID-19/covid-webap/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/vasilisaskvortsova/Documents/COVID-19/covid-webap/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/vasilisaskvortsova/Documents/COVID-19/covid-webap/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/vasilisaskvortsova/Documents/COVID-19/covid-webap/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/vasilisaskvortsova/Documents/COVID-19/covid-webap/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/vasilisaskvortsova/Documents/COVID-19/covid-webap/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/vasilisaskvortsova/Documents/COVID-19/covid-webap/src/components/QuizBlock/QuizBlock.js\";\nimport React, { Component } from 'react';\nimport { API_URL } from '../../config';\nimport Quiz from '../Quiz/Quiz';\nimport Report from '../Report/Report';\nimport ReportNA from '../ReportNA/ReportNA';\nimport FreeReport from '../FreeReport/FreeReport';\nimport ButtonQuiz from '../ButtonQuiz/ButtonQuiz';\nimport CheckboxQuiz from '../CheckboxQuiz/CheckboxQuiz';\n\nvar QuizBlock =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(QuizBlock, _Component);\n\n  function QuizBlock(props) {\n    var _this;\n\n    _classCallCheck(this, QuizBlock);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(QuizBlock).call(this, props)); // Get the right questions JSON part\n\n    var quizQuestionsBlock = _this.props.location.state.questions.filter(function (d) {\n      return d.surveytag === _this.props.location.state.block_info.surveytag;\n    });\n\n    console.log(quizQuestionsBlock);\n    _this.state = {\n      counter: 0,\n      questionCount: 1,\n      // count across all questions in the questionnaire \n      question: '',\n      answerOptions: [],\n      answer: '',\n      qtype: '',\n      // the type of the question to be asked\n      questionId: '',\n      // Question id stored in the JS object, does not have to be consecuitive. \n      answersCount: {},\n      result: '',\n      constraint: [],\n      quizQuestionsBlock: quizQuestionsBlock,\n      participant_info: _this.props.location.state.participant_info,\n      image: '',\n      // image question\n      image_a: '',\n      // image - answer if available\n      // This is to be recorded and POSTED to the DB\n      answered_questionsId: [],\n      answered_questionsContent: []\n    };\n    _this.handleAnswerSelected = _this.handleAnswerSelected.bind(_assertThisInitialized(_this));\n    _this.redirectToSurvey = _this.redirectToSurvey.bind(_assertThisInitialized(_this));\n    console.log(_this.state);\n    return _this;\n  }\n\n  _createClass(QuizBlock, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var firstQuestion = this.state.quizQuestionsBlock[0];\n      var image_item = this.state.quizQuestionsBlock[0].image === undefined ? null : require('../../images/' + this.state.quizQuestionsBlock[0].image);\n      var image_a = this.state.quizQuestionsBlock[0].image_a === undefined ? null : require('../../images/' + this.state.quizQuestionsBlock[0].image_a);\n      var shuffledAnswerOptions = this.state.quizQuestionsBlock.map(function (question) {\n        return _this2.NoShuffleArray(question.answers);\n      });\n      document.body.style.background = '#fff';\n      this.setState({\n        questionId: firstQuestion.questionId,\n        qtype: firstQuestion.qtype,\n        question: firstQuestion.question,\n        answerOptions: shuffledAnswerOptions[0],\n        constraint: firstQuestion.constraint,\n        image: image_item,\n        image_a: image_a\n      });\n    }\n  }, {\n    key: \"shuffleArray\",\n    value: function shuffleArray(array) {\n      var currentIndex = array.length,\n          temporaryValue,\n          randomIndex; // While there remain elements to shuffle...\n\n      while (0 !== currentIndex) {\n        // Pick a remaining element...\n        randomIndex = Math.floor(Math.random() * currentIndex);\n        currentIndex -= 1; // And swap it with the current element.\n\n        temporaryValue = array[currentIndex];\n        array[currentIndex] = array[randomIndex];\n        array[randomIndex] = temporaryValue;\n      }\n\n      return array;\n    }\n  }, {\n    key: \"NoShuffleArray\",\n    value: function NoShuffleArray(array) {\n      var currentIndex = array.length;\n      return array;\n    } // onAnswerSelected points to this function in AnswerOption.js \n\n  }, {\n    key: \"handleAnswerSelected\",\n    value: function handleAnswerSelected(answerContent, questionId, event) {\n      var _this3 = this;\n\n      this.setUserAnswer(event.currentTarget.value, answerContent, questionId); // event.currentTarget.value); // to be changed to see what is recorded \n\n      if (this.state.questionCount < 1) {\n        // this.state.quizQuestionsBlock.length CHANGE BACK this.state.quizQuestionsBlock.lengthto change to the number of questions in this part of the Survey\n        setTimeout(function () {\n          return _this3.setNextQuestion();\n        }, 300);\n      } else {\n        setTimeout(function () {\n          return _this3.redirectToSurvey();\n        }, 300);\n      }\n    }\n  }, {\n    key: \"setUserAnswer\",\n    value: function setUserAnswer(answer, answerContent, questionId) {\n      // This is to be recorded and POSTED to the DB\n      var answered_questionsId = this.state.answered_questionsId;\n      answered_questionsId.push(questionId);\n      var answered_questionsContent = this.state.answered_questionsContent;\n      answered_questionsContent.push(answerContent);\n      this.setState(function (state, props) {\n        return {\n          answer: answer,\n          answered_questionsId: answered_questionsId,\n          answered_questionsContent: answered_questionsContent\n        };\n      });\n    }\n  }, {\n    key: \"setNextQuestion\",\n    value: function setNextQuestion() {\n      var counter = this.state.counter + 1;\n      var questionCount = this.state.questionCount + 1;\n      var nextQuestion = this.state.quizQuestionsBlock[counter];\n      var image_item = this.state.quizQuestionsBlock[counter].image === undefined ? null : require('../../images/' + this.state.quizQuestionsBlock[counter].image);\n      var image_a = this.state.quizQuestionsBlock[counter].image_a === undefined ? null : require('../../images/' + this.state.quizQuestionsBlock[counter].image_a);\n      this.setState({\n        counter: counter,\n        questionCount: questionCount,\n        questionId: nextQuestion.questionId,\n        question: nextQuestion.question,\n        answerOptions: nextQuestion.answers,\n        answer: '',\n        qtype: nextQuestion.qtype,\n        constraint: nextQuestion.constraint,\n        image: image_item,\n        image_a: image_a\n      });\n    }\n  }, {\n    key: \"redirectToSurvey\",\n    value: function redirectToSurvey() {\n      var block_id = this.state.participant_info.block_number + 1;\n      console.log('Block_number QuizBlock:', this.state.participant_info.block_number);\n\n      if (this.state.participant_info.block_number < this.state.participant_info.TotalBlock) {\n        var completed = 'no';\n      } else if (this.state.participant_info.block_number === this.state.participant_info.TotalBlock) {\n        var completed = 'yes';\n      }\n\n      var body = {\n        'participant_id': this.state.participant_info.participant_id,\n        'prolific_id': this.state.participant_info.prolific_id,\n        'longit_id': this.state.participant_info.longit_id,\n        'study_id': this.state.participant_info.study_id,\n        'date': this.state.participant_info.date,\n        'block_number': this.state.participant_info.block_number + 1,\n        'block_name': this.props.location.state.block_info.surveytag,\n        'question_ids': this.state.answered_questionsId,\n        'answers': this.state.answered_questionsContent,\n        'survey_completed': completed\n      };\n      console.log(body);\n      fetch(\"\".concat(API_URL, \"/participants_question_data/create/\") + this.state.participant_info.participant_id + \"/\" + block_id + \"/\" + this.state.participant_info.prolific_id, {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(body)\n      });\n      this.props.history.push({\n        pathname: \"/Survey\",\n        state: {\n          participant_info: this.state.participant_info,\n          newblock_frame: false,\n          finished: true\n        }\n      });\n    }\n  }, {\n    key: \"setResults\",\n    value: function setResults(result) {\n      if (result.length === 1) {\n        this.setState({\n          result: result[0]\n        });\n      } else {\n        this.setState({\n          result: 'Undetermined'\n        });\n      }\n    }\n  }, {\n    key: \"renderQuiz\",\n    value: function renderQuiz() {\n      if (this.state.qtype === \"quiz\") {\n        return React.createElement(Quiz, {\n          answer: this.state.answer,\n          answerOptions: this.state.answerOptions,\n          questionId: this.state.questionId,\n          questionCount: this.state.questionCount,\n          question: this.state.question,\n          questionTotal: this.state.quizQuestionsBlock.length,\n          onAnswerSelected: this.handleAnswerSelected,\n          image: this.state.image,\n          image_a: this.state.image_a,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        });\n      } else if (this.state.qtype === \"report\") {\n        return React.createElement(Report, {\n          answer: this.state.answer,\n          answerOptions: this.state.answerOptions,\n          questionId: this.state.questionId,\n          questionCount: this.state.questionCount,\n          question: this.state.question,\n          questionTotal: this.state.quizQuestionsBlock.length,\n          onAnswerSelected: this.handleAnswerSelected,\n          constraint: this.state.constraint,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 217\n          },\n          __self: this\n        });\n      } else if (this.state.qtype === \"report-na\") {\n        return React.createElement(ReportNA, {\n          answer: this.state.answer,\n          answerOptions: this.state.answerOptions,\n          questionId: this.state.questionId,\n          questionCount: this.state.questionCount,\n          question: this.state.question,\n          questionTotal: this.state.quizQuestionsBlock.length,\n          onAnswerSelected: this.handleAnswerSelected,\n          constraint: this.state.constraint,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 234\n          },\n          __self: this\n        });\n      } else if (this.state.qtype === \"free-report\") {\n        return React.createElement(FreeReport, {\n          answer: this.state.answer,\n          answerOptions: this.state.answerOptions,\n          questionId: this.state.questionId,\n          questionCount: this.state.questionCount,\n          question: this.state.question,\n          questionTotal: this.state.quizQuestionsBlock.length,\n          onAnswerSelected: this.handleAnswerSelected,\n          constraint: this.state.constraint,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 250\n          },\n          __self: this\n        });\n      } else if (this.state.qtype === \"button\") {\n        return React.createElement(ButtonQuiz, {\n          questionId: this.state.questionId,\n          questionCount: this.state.questionCount,\n          question: this.state.question,\n          questionTotal: this.state.quizQuestionsBlock.length,\n          onAnswerSelected: this.handleAnswerSelected,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 266\n          },\n          __self: this\n        });\n      } else if (this.state.qtype === \"checkbox\") {\n        return React.createElement(CheckboxQuiz, {\n          answer: this.state.answer,\n          answerOptions: this.state.answerOptions,\n          questionId: this.state.questionId,\n          questionCount: this.state.questionCount,\n          question: this.state.question,\n          questionTotal: this.state.quizQuestionsBlock.length,\n          onAnswerSelected: this.handleAnswerSelected,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 279\n          },\n          __self: this\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"QuizBlock\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"QuizBlock-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 295\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296\n        },\n        __self: this\n      }, this.state.quizQuestionsBlock[this.state.counter].title)), this.state.result ? this.redirectToSurvey() : this.renderQuiz());\n    }\n  }]);\n\n  return QuizBlock;\n}(Component);\n\nexport default QuizBlock;","map":{"version":3,"sources":["/Users/vasilisaskvortsova/Documents/COVID-19/covid-webap/src/components/QuizBlock/QuizBlock.js"],"names":["React","Component","API_URL","Quiz","Report","ReportNA","FreeReport","ButtonQuiz","CheckboxQuiz","QuizBlock","props","quizQuestionsBlock","location","state","questions","filter","d","surveytag","block_info","console","log","counter","questionCount","question","answerOptions","answer","qtype","questionId","answersCount","result","constraint","participant_info","image","image_a","answered_questionsId","answered_questionsContent","handleAnswerSelected","bind","redirectToSurvey","firstQuestion","image_item","undefined","require","shuffledAnswerOptions","map","NoShuffleArray","answers","document","body","style","background","setState","array","currentIndex","length","temporaryValue","randomIndex","Math","floor","random","answerContent","event","setUserAnswer","currentTarget","value","setTimeout","setNextQuestion","push","nextQuestion","block_id","block_number","TotalBlock","completed","participant_id","prolific_id","longit_id","study_id","date","fetch","method","headers","JSON","stringify","history","pathname","newblock_frame","finished","title","renderQuiz"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { API_URL } from '../../config';\n\nimport Quiz from '../Quiz/Quiz';\nimport Report from '../Report/Report';\nimport ReportNA from '../ReportNA/ReportNA';\nimport FreeReport from '../FreeReport/FreeReport';\nimport ButtonQuiz from '../ButtonQuiz/ButtonQuiz';\nimport CheckboxQuiz from '../CheckboxQuiz/CheckboxQuiz'; \n\n\nclass QuizBlock extends Component {\n  constructor(props) {\n    super(props);\n\n    // Get the right questions JSON part\n    var quizQuestionsBlock = this.props.location.state.questions.filter(d => d.surveytag === this.props.location.state.block_info.surveytag);\n    \n    console.log(quizQuestionsBlock)\n    \n    this.state = {\n      counter: 0,\n      questionCount: 1, // count across all questions in the questionnaire \n      question: '',\n      answerOptions: [],\n      answer: '',\n      qtype: '',      // the type of the question to be asked\n      questionId: '', // Question id stored in the JS object, does not have to be consecuitive. \n      answersCount: {},\n      result: '',\n      constraint: [], \n      quizQuestionsBlock: quizQuestionsBlock,\n      participant_info: this.props.location.state.participant_info,\n      image: '', // image question\n      image_a: '', // image - answer if available\n      \n      // This is to be recorded and POSTED to the DB\n      answered_questionsId      : [],\n      answered_questionsContent : [],\n    \n    };\n\n   this.handleAnswerSelected  = this.handleAnswerSelected.bind(this);\n   this.redirectToSurvey      = this.redirectToSurvey.bind(this);\n    \n    console.log(this.state)\n  }\n\n  componentDidMount() {\n    const firstQuestion = this.state.quizQuestionsBlock[0]\n    const image_item    = (this.state.quizQuestionsBlock[0].image=== undefined) ? null : require('../../images/' + this.state.quizQuestionsBlock[0].image)\n    const image_a       = (this.state.quizQuestionsBlock[0].image_a=== undefined) ? null : require('../../images/' + this.state.quizQuestionsBlock[0].image_a)\n     \n    var shuffledAnswerOptions = this.state.quizQuestionsBlock.map(question =>this.NoShuffleArray(question.answers)); \n    \n    \n    document.body.style.background= '#fff';\n    this.setState({\n      questionId:    firstQuestion.questionId,\n      qtype:         firstQuestion.qtype,\n      question:      firstQuestion.question,\n      answerOptions: shuffledAnswerOptions[0],\n      constraint:    firstQuestion.constraint,\n      image:         image_item, \n      image_a:       image_a, \n      \n    });\n  }\n\n  shuffleArray(array) {\n    var currentIndex = array.length,\n      temporaryValue,\n      randomIndex;\n\n    // While there remain elements to shuffle...\n    while (0 !== currentIndex) {\n      // Pick a remaining element...\n      randomIndex = Math.floor(Math.random() * currentIndex);\n      currentIndex -= 1;\n\n      // And swap it with the current element.\n      temporaryValue      = array[currentIndex];\n      array[currentIndex] = array[randomIndex];\n      array[randomIndex]  = temporaryValue;\n    }\n\n    return array;\n  }\n\nNoShuffleArray(array) {\n    var currentIndex = array.length;\n    return array;\n  }\n  // onAnswerSelected points to this function in AnswerOption.js \n  handleAnswerSelected(answerContent,questionId,event) {\n    \n    this.setUserAnswer(event.currentTarget.value,answerContent,questionId); // event.currentTarget.value); // to be changed to see what is recorded \n\n    if (this.state.questionCount < 1) {  // this.state.quizQuestionsBlock.length CHANGE BACK this.state.quizQuestionsBlock.lengthto change to the number of questions in this part of the Survey\n      setTimeout(() => this.setNextQuestion(), 300);\n    } else {\n      setTimeout(() => this.redirectToSurvey(), 300); \n    }\n  }\n\n  setUserAnswer(answer,answerContent,questionId) {\n\n    // This is to be recorded and POSTED to the DB\n    let answered_questionsId = this.state.answered_questionsId;\n      answered_questionsId.push(questionId)\n\n    let answered_questionsContent = this.state.answered_questionsContent;\n      answered_questionsContent.push(answerContent)\n\n    this.setState((state, props) => ({\n      answer: answer,\n      answered_questionsId: answered_questionsId,\n      answered_questionsContent: answered_questionsContent, \n    }));\n\n  }\n\n  setNextQuestion() {\n    const counter       = this.state.counter + 1;\n    const questionCount = this.state.questionCount + 1;\n    const nextQuestion  = this.state.quizQuestionsBlock[counter]\n    const image_item    = (this.state.quizQuestionsBlock[counter].image=== undefined) ? null : require('../../images/' + this.state.quizQuestionsBlock[counter].image)\n    const image_a       = (this.state.quizQuestionsBlock[counter].image_a=== undefined) ? null : require('../../images/' + this.state.quizQuestionsBlock[counter].image_a)\n        \n\n    this.setState({\n      counter: counter,\n      questionCount: questionCount,\n      questionId: nextQuestion.questionId,\n      question: nextQuestion.question,\n      answerOptions: nextQuestion.answers,\n      answer: '',\n      qtype: nextQuestion.qtype,\n      constraint: nextQuestion.constraint,\n      image: image_item,\n      image_a: image_a,\n       \n    });\n  }\n\n  redirectToSurvey ()\n\n  {\n    let block_id = this.state.participant_info.block_number+1\n    console.log('Block_number QuizBlock:', this.state.participant_info.block_number)\n\n    if (this.state.participant_info.block_number < this.state.participant_info.TotalBlock) {\n      var completed = 'no'}\n    else if (this.state.participant_info.block_number === this.state.participant_info.TotalBlock) {\n      var completed = 'yes'\n    }\n\n    let body     = {        'participant_id'  : this.state.participant_info.participant_id, \n                            'prolific_id'     : this.state.participant_info.prolific_id, \n                            'longit_id'       : this.state.participant_info.longit_id, \n                            'study_id'        : this.state.participant_info.study_id,\n                             'date'           : this.state.participant_info.date,\n                            'block_number'    : this.state.participant_info.block_number+1, \n                            'block_name'      : this.props.location.state.block_info.surveytag, \n                            'question_ids'    : this.state.answered_questionsId, \n                            'answers'         : this.state.answered_questionsContent,\n                            'survey_completed': completed\n                          }\n\n  console.log(body)\n  fetch(`${API_URL}/participants_question_data/create/` + this.state.participant_info.participant_id + `/` + block_id + `/` + this.state.participant_info.prolific_id, {\n       method: 'POST',\n       headers: {\n         'Accept': 'application/json',\n         'Content-Type': 'application/json',\n       },    \n       body: JSON.stringify(body)\n     })\n\n  this.props.history.push({\n      pathname: `/Survey`,\n      state: {participant_info:this.state.participant_info,newblock_frame: false, finished: true}\n    })\n  }\n  \n  setResults(result) {\n    if (result.length === 1) {\n      this.setState({ result: result[0] });\n    } else {\n      this.setState({ result: 'Undetermined' });\n    }\n  }\n\n  renderQuiz() {\n    if (this.state.qtype === \"quiz\") \n    { \n      return (\n        <Quiz\n          answer          ={this.state.answer}  \n          answerOptions   ={this.state.answerOptions} \n          questionId      ={this.state.questionId}\n          questionCount   ={this.state.questionCount}\n          question        ={this.state.question}\n          questionTotal   ={this.state.quizQuestionsBlock.length}\n          onAnswerSelected={this.handleAnswerSelected}\n          image           ={this.state.image}\n          image_a         ={this.state.image_a}\n          \n        />\n      );\n    } \n\n    else if (this.state.qtype === \"report\")\n\n    {  \n      return (\n        <Report\n          answer          ={this.state.answer}\n          answerOptions   ={this.state.answerOptions}\n          questionId      ={this.state.questionId}\n          questionCount   ={this.state.questionCount}\n          question        ={this.state.question}\n          questionTotal   ={this.state.quizQuestionsBlock.length}\n          onAnswerSelected={this.handleAnswerSelected}\n          constraint      ={this.state.constraint}\n        />\n      );\n  }\n\n  else if (this.state.qtype === \"report-na\") \n  {\n\n    return (\n        <ReportNA\n          answer          ={this.state.answer}\n          answerOptions   ={this.state.answerOptions}\n          questionId      ={this.state.questionId}\n          questionCount   ={this.state.questionCount}\n          question        ={this.state.question}\n          questionTotal   ={this.state.quizQuestionsBlock.length}\n          onAnswerSelected={this.handleAnswerSelected}\n          constraint      ={this.state.constraint}\n      />\n    );\n  }\n\n  else if (this.state.qtype === \"free-report\") \n  {\n    return (\n        <FreeReport\n          answer          ={this.state.answer}\n          answerOptions   ={this.state.answerOptions}\n          questionId      ={this.state.questionId}\n          questionCount   ={this.state.questionCount}\n          question        ={this.state.question}\n          questionTotal   ={this.state.quizQuestionsBlock.length}\n          onAnswerSelected={this.handleAnswerSelected}\n          constraint      ={this.state.constraint}\n      />\n    );\n  }\n\n  else if (this.state.qtype === \"button\") \n  {\n    return (\n        <ButtonQuiz \n          questionId      ={this.state.questionId}\n          questionCount   ={this.state.questionCount}\n          question        ={this.state.question}\n          questionTotal   ={this.state.quizQuestionsBlock.length}\n          onAnswerSelected={this.handleAnswerSelected}\n      />\n    );\n  }\n\n    else if (this.state.qtype === \"checkbox\") \n  {\n    return (\n        <CheckboxQuiz \n          answer          ={this.state.answer}  \n          answerOptions   ={this.state.answerOptions} \n          questionId      ={this.state.questionId}\n          questionCount   ={this.state.questionCount}\n          question        ={this.state.question}\n          questionTotal   ={this.state.quizQuestionsBlock.length}\n          onAnswerSelected={this.handleAnswerSelected}\n      />\n    );\n  }\n}\n\n  render() {\n    return (\n      <div className=\"QuizBlock\">\n        <div className=\"QuizBlock-header\">\n          <h2>{this.state.quizQuestionsBlock[this.state.counter].title}</h2>\n        </div>\n        {this.state.result ? this.redirectToSurvey() : this.renderQuiz()} \n      </div>\n    );\n  }\n}\n\nexport default QuizBlock;\n"]},"metadata":{},"sourceType":"module"}